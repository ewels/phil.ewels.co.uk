---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageTitle from "../../components/PageTitle.astro";
import HorizontalCard from "../../components/HorizontalCard.astro";

import publications from "./publications.json";

for (var i = 0; i < publications.length; i++) {
  const response = await fetch("https://api.crossref.org/works/" + publications[i].doi);
  const data = await response.json();
  const pub = data.message;
  publications[i]["title"] = pub.title[0];
  publications[i]["journal"] = pub["container-title"].length ? pub["container-title"] : pub["institution"][0]["name"];
  publications[i]["pub_year"] = pub.published["date-parts"][0][0];
  var authors = pub.author;
  const num_authors = 10;
  if (authors.length > num_authors) {
    authors = authors.slice(0, num_authors - 1).concat({ family: "..." }, authors.slice(-1));
  }
  publications[i]["authors"] = authors.map((author) =>
    author.family ? author.family + " " + (author.given ?? "" ? author.given.substr(0, 1) : "") : author.name
  );
}
---

<BaseLayout title="Publications">
  <PageTitle>Publications</PageTitle>
  {
    publications.map((pub) => (
      <>
        <HorizontalCard
          title={pub.title}
          subtitle={pub.journal + " (" + pub.pub_year + ")"}
          desc={pub.authors.join(", ")}
          url={"/publications/" + pub.slug}
        />
      </>
    ))
  }
</BaseLayout>
